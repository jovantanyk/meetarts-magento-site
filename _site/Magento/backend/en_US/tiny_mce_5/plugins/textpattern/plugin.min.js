!function(){"use strict";var j=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(){return(i=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};function o(t,n,e){if(e||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||((r=r||Array.prototype.slice.call(n,0,o))[o]=n[o]);return t.concat(r||Array.prototype.slice.call(n))}function t(e){return function(t){return n=typeof(t=t),(null===t?"null":"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n)===e;var n}}function n(){}function a(t){return function(){return t}}function r(t){return t}function e(){return l}var u=t("string"),_=t("object"),c=t("array"),f=a(!1),s=a(!0),l={fold:function(t,n){return t()},isSome:f,isNone:s,getOr:r,getOrThunk:d,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(void 0),or:r,orThunk:d,map:e,each:n,bind:e,exists:f,forall:s,filter:function(){return l},toArray:function(){return[]},toString:a("none()")};function d(t){return t()}function m(t,n){return-1<q.call(t,n)}function g(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var a=t[o];r[o]=n(a,o)}return r}function p(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e)}function U(t,n){for(var e=[],r=0,o=t.length;r<o;r++){var a=t[r];n(a,r)&&e.push(a)}return e}function L(t,n,e){for(var r,o=t,a=o.length-1;0<=a;a--)r=o[a],e=n(e,r,a);return e}function V(t,n){for(var e=0,r=t.length;e<r;++e)if(!0!==n(t[e],e))return;return 1}function h(e){function t(){return o}function n(t){return t(e)}var r=a(e),o={fold:function(t,n){return n(e)},isSome:s,isNone:f,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return h(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:l},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return o}var v={some:h,none:e,from:function(t){return null==t?l:h(t)}},W=Array.prototype.slice,q=Array.prototype.indexOf,F=Object.keys,G=Object.hasOwnProperty;function H(t){var n=[],e=[];return p(t,function(t){t.fold(function(t){n.push(t)},function(t){e.push(t)})}),{errors:n,values:e}}function J(t){return"inline-command"===t.type||"inline-format"===t.type}function K(t){return"block-command"===t.type||"block-format"===t.type}function X(r){function o(t){return pt({message:t,pattern:r})}function t(t,n,e){if(void 0===r.format)return void 0!==r.cmd?u(r.cmd)?A(e(r.cmd,r.value)):o(t+" pattern has non-string `cmd` parameter"):o(t+" pattern is missing both `format` and `cmd` parameters");e=void 0;if(c(r.format)){if(!V(r.format,u))return o(t+" pattern has non-string items in the `format` array");e=r.format}else{if(!u(r.format))return o(t+" pattern has non-string `format` parameter");e=[r.format]}return A(n(e))}var e,a;return _(r)?u(r.start)?void 0===r.end?void 0!==r.replacement?u(r.replacement)?0===r.start.length?o("Replacement pattern has empty `start` parameter"):A({type:"inline-command",start:"",end:r.start,cmd:"mceInsertContent",value:r.replacement}):o("Replacement pattern has non-string `replacement` parameter"):0===r.start.length?o("Block pattern has empty `start` parameter"):t("Block",function(t){return{type:"block-format",start:r.start,format:t[0]}},function(t,n){return{type:"block-command",start:r.start,cmd:t,value:n}}):u(r.end)?0===r.start.length&&0===r.end.length?o("Inline pattern has empty `start` and `end` parameters"):(e=r.start,0===(a=r.end).length&&(a=e,e=""),t("Inline",function(t){return{type:"inline-format",start:e,end:a,format:t}},function(t,n){return{type:"inline-command",start:e,end:a,cmd:t,value:n}})):o("Inline pattern has non-string `end` parameter"):o("Raw pattern is missing `start` parameter"):o("Raw pattern is not an object")}function z(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0}function Q(t){return{inlinePatterns:U(t,J),blockPatterns:(t=U(t,K),n=function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1},(t=W.call(t,0)).sort(n),t)};var n}function Y(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=ht.console;e&&(e.error||e.log).apply(e,t)}function Z(t){t=t.getParam("forced_root_block","p");return!1===t?"":!0===t?"p":t}function y(t,n){return{container:t,offset:n}}function b(t){return t.nodeType===Node.TEXT_NODE}function k(t,n,e,r){void 0===r&&(r=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),r&&!e(n.startContainer)&&(b(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),b(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),D(t,o,e),o!==a)&&D(t,a,e)}function O(t){return 0===t.start.length}function w(t,n){n=v.from(t.dom.getParent(n.startContainer,t.dom.isBlock));return""===Z(t)?n.orThunk(function(){return v.some(t.getBody())}):n}function C(n){return function(t){return n===t?-1:0}}function E(t,n,e){var r;return b(t)&&0<=n?v.some(y(t,n)):(r=B(I),v.from(r.backwards(t,n,C(t),e)).map(function(t){return y(t.container,t.container.data.length)}))}function $(t,n,e){if(b(n)&&(e<0||e>n.data.length))return[];for(var r=[e],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){r.push(i);break}o=a}return o===t?r.reverse():[]}function x(t,n,e,r,o){return{start:$(t,n,e),end:$(t,r,o)}}function tt(t,n){var n=n.slice(),e=n.pop(),r=v.some(t);return p(n,function(t,n){var e;e=t,r=r.bind(function(t){return v.from(t.childNodes[e])})}),r.bind(function(t){return b(t)&&(e<0||e>t.data.length)?v.none():v.some({node:t,offset:e})})}function nt(n,e){return tt(n,e.start).bind(function(t){var r=t.node,o=t.offset;return tt(n,e.end).map(function(t){var n=t.node,t=t.offset,e=document.createRange();return e.setStart(r,o),e.setEnd(n,t),e})})}function et(r,o,n){var t,e,a;e=t=o,(b(t)&&t.length<=0?v.some(y(t,0)):(a=B(I),v.from(a.forwards(t,0,C(t),e)).map(function(t){return y(t.container,0)}))).each(function(t){var e=t.container;wt(e,n.start.length,o).each(function(t){var n=r.createRng();n.setStart(e,0),n.setEnd(t.container,t.offset),k(r,n,function(t){return t===o})})})}function rt(e,r){var o=e.dom,t=e.selection.getRng();return w(e,t).filter(function(t){var n=Z(e),n=""===n&&o.is(t,"body")||o.is(t,n);return null!==t&&n}).bind(function(n){var i,e=n.textContent,t=r,u=(i=e).replace("Â "," ");return function(t,n){for(var e,r=0,o=t.length;r<o;r++){var a=t[r];if(e=a,0===i.indexOf(e.start)||0===u.indexOf(e.start))return v.some(a);if(n(a,r))break}return v.none()}(t,f).map(function(t){return kt.trim(e).length===t.start.length?[]:[{pattern:t,range:x(o.getRoot(),n,0,n,0)}]})}).getOr([])}function ot(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})}function R(t,n){t=t.createRng();return t.setStartAfter(n.start),t.setEndBefore(n.end),t}function at(t,n,e){var e=nt(t.getRoot(),e).getOrDie("Unable to resolve path range"),r=e.startContainer,o=e.endContainer,o=0===e.endOffset?o:o.splitText(e.endOffset),r=0===e.startOffset?r:r.splitText(e.startOffset);return{prefix:n,end:o.parentNode.insertBefore(ot(t,n+"-end"),o),start:r.parentNode.insertBefore(ot(t,n+"-start"),r)}}function it(t,n,e){D(t,t.get(n.prefix+"-end"),e),D(t,t.get(n.prefix+"-start"),e)}function ut(n,t,e){n.selection.setRng(e),"inline-format"===t.type?p(t.format,function(t){n.formatter.apply(t)}):n.execCommand(t.cmd,!1,t.value)}function ct(e,r,o){var a=e.selection.getRng();return!1===a.collapsed?[]:w(e,a).bind(function(t){var n=a.startOffset-(o?1:0);return Et(e,r,a.startContainer,n,t)}).fold(function(){return[]},function(t){return t.matches})}function ft(s,t){var l,n,r,e,o,a;0!==t.length&&(l=s.dom,n=s.selection.getBookmark(),r=l,t=t,e=(new Date).getTime(),o="mce_textpattern_"+Math.floor(1e9*Math.random())+ ++Ct+String(e),a=L(t,function(t,n){var e=at(r,o+"_end"+t.length,n.endRng);return t.concat([i(i({},n),{endMarker:e})])},[]),p(L(a,function(t,n){var e=a.length-t.length-1,e=O(n.pattern)?n.endMarker:at(r,o+"_start"+e,n.startRng);return t.concat([i(i({},n),{startMarker:e})])},[]),function(t){function n(t){return t===f}var e,r,o,a,i,u,c,f=l.getParent(t.startMarker.start,l.isBlock);O(t.pattern)?(a=t.pattern,i=t.endMarker,r=n,i=R((o=s).dom,i),k(o.dom,i,r),ut(o,a,i)):(r=t.pattern,o=t.startMarker,a=t.endMarker,i=n,c=R(u=(e=s).dom,a),k(u,R(u,o),i),k(u,c,i),ut(e,r,R(u,{prefix:o.prefix,start:o.end,end:a.start}))),it(l,t.endMarker,n),it(l,t.startMarker,n)}),s.selection.moveToBookmark(n))}function st(t,n){var e=ct(t,n.inlinePatterns,!0);0<e.length&&t.undoManager.transact(function(){ft(t,e)})}function lt(t,n,e){for(var r=0;r<t.length;r++)if(e(t[r],n))return 1}function dt(n,e){var r=[",",".",";",":","!","?"],o=[32];n.on("keydown",function(t){13===t.keyCode&&!bt.modifierPressed(t)&&function(r,t){var o,a;if(r.selection.isCollapsed())return o=ct(r,t.inlinePatterns,!1),(0<(a=rt(r,t.blockPatterns)).length||0<o.length)&&(r.undoManager.add(),r.undoManager.extra(function(){r.execCommand("mceInsertNewLine")},function(){r.insertContent("\ufeff"),ft(r,o),e=r,0!==(t=a).length&&(n=e.selection.getBookmark(),p(t,function(t){var r,n=(r=e).dom,o=(t=t).pattern,n=nt(n.getRoot(),t.range).getOrDie("Unable to resolve path range");w(r,n).each(function(t){var n,e;"block-format"===o.type?(n=o.format,e=(e=r.formatter).get(n),c(e)&&(0<e.length?v.some(e[0]):v.none()).exists(function(t){return G.call(t,"block")})&&r.undoManager.transact(function(){et(r.dom,t,o),r.formatter.apply(o.format)})):"block-command"===o.type&&r.undoManager.transact(function(){et(r.dom,t,o),r.execCommand(o.cmd,!1,o.value)})})}),e.selection.moveToBookmark(n));var e,t=r.selection.getRng(),n=E(t.startContainer,t.startOffset,r.dom.getRoot());r.execCommand("mceInsertNewLine"),n.each(function(t){var n=t.container;"\ufeff"===n.data.charAt(t.offset-1)&&(n.deleteData(t.offset-1,1),D(r.dom,n.parentNode,function(t){return t===r.dom.getRoot()}))})}),1)}(n,e.get())&&t.preventDefault()},!0),n.on("keyup",function(t){lt(o,t,function(t,n){return t===n.keyCode&&!1===bt.modifierPressed(n)})&&st(n,e.get())}),n.on("keypress",function(t){lt(r,t,function(t,n){return t.charCodeAt(0)===n.charCode})&&yt.setEditorTimeout(n,function(){st(n,e.get())})})}var T=[{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}];if(!c(T))throw new Error("cases must be an array");if(0===T.length)throw new Error("there must be at least one case");function P(e){return{isValue:s,isError:f,getOr:a(e),getOrThunk:a(e),getOrDie:a(e),or:function(t){return P(e)},orThunk:function(t){return P(e)},fold:function(t,n){return n(e)},map:function(t){return P(t(e))},mapError:function(t){return P(e)},each:function(t){t(e)},bind:function(t){return t(e)},exists:function(t){return t(e)},forall:function(t){return t(e)},toOptional:function(){return v.some(e)}}}function N(e){return{isValue:f,isError:s,getOr:r,getOrThunk:function(t){return t()},getOrDie:function(){throw t=String(e),new Error(t);var t},or:r,orThunk:function(t){return t()},fold:function(t,n){return t(e)},map:function(t){return N(e)},mapError:function(t){return N(t(e))},each:n,bind:function(t){return N(e)},exists:f,forall:s,toOptional:v.none}}function S(t,e,r){var n;return b(t)?(n=t.textContent,0<=e&&e<=n.length?v.some(y(t,e)):(n=B(I),v.from(n.backwards(t,e,C(t),r)).bind(function(t){var n=t.container.data;return S(t.container,e+n.length,r)}))):v.none()}function mt(r,n,o,t){var e,a=n.start,i=t.container,t=t.offset,u=a,c=function(t,n){t=t.data.substring(0,n),n=t.lastIndexOf(u.charAt(u.length-1)),t=t.lastIndexOf(u);return-1!==t?t+u.length:-1!==n?n+1:-1},f=o,s=B(r,(e=r,function(t){return e.isBlock(t)||m(["BR","IMG","HR","INPUT"],t.nodeName)||"false"===e.getContentEditable(t)}));return v.from(s.backwards(i,t,c,f)).bind(function(e){var t;return e.offset>=a.length?((t=r.createRng()).setStart(e.container,e.offset-a.length),t.setEnd(e.container,e.offset),v.some(t)):(t=e.offset-a.length,S(e.container,t,o).map(function(t){var n=r.createRng();return n.setStart(t.container,t.offset),n.setEnd(e.container,e.offset),n}).filter(function(t){return t.toString()===a}).orThunk(function(){return mt(r,n,o,y(e.container,0))}))})}var M=[],gt={},A=(p(T,function(t,r){var n=F(t);if(1!==n.length)throw new Error("one and only one name per case");var o=n[0],a=t[o];if(void 0!==gt[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!c(a))throw new Error("case arguments must be an array");M.push(o),gt[o]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(n!==a.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+a.length+" ("+a+"), got "+n);return{fold:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(t.length!==T.length)throw new Error("Wrong number of arguments to fold. Expected "+T.length+", got "+t.length);return t[r].apply(null,e)},match:function(t){var n=F(t);if(M.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+M.join(",")+"\nActual: "+n.join(","));if(V(M,function(t){return m(n,t)}))return t[o].apply(null,e);throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+M.join(", "))},log:function(t){console.log(t,{constructors:M,constructor:o,params:e})}}}}),P),pt=N,ht="undefined"!=typeof window?window:Function("return this;")(),vt=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],yt=tinymce.util.Tools.resolve("tinymce.util.Delay"),bt=tinymce.util.Tools.resolve("tinymce.util.VK"),kt=tinymce.util.Tools.resolve("tinymce.util.Tools"),Ot=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),B=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),D=function(t,n,e){var r;n&&t.isEmpty(n)&&!e(n)&&(r=n.parentNode,t.remove(n),D(t,r,e))},I=Ot.DOM,wt=function(t,n,e){var r,o;return b(t)?(r=t.textContent,n<=r.length?v.some(y(t,n)):(o=B(I),v.from(o.forwards(t,n,C(t),e)).bind(function(t){return wt(t.container,n-r.length,e)}))):v.none()},Ct=0,Et=function(u,c,f,s,l){var d=u.dom;return E(f,s,d.getRoot()).bind(function(t){var n=d.createRng();n.setStart(l,0),n.setEnd(f,s);for(var e=n.toString(),r=0;r<c.length;r++){var o=c[r],a=o.end,i=e.length-a.length;if(""===(a=a)||e.length>=a.length&&e.substr(i,i+a.length)===a){i=c.slice(),a=(i.splice(r,1),function(f,s,l){var d=f.dom,m=d.getRoot(),g=l.pattern,p=l.position.container,h=l.position.offset;return S(p,h-l.pattern.end.length,s).bind(function(t){var e,r,o,n,a,i,u,c=x(m,t.container,t.offset,p,h);return O(g)?v.some({matches:[{pattern:g,startRng:c,endRng:c}],position:t}):(u=Et(f,l.remainingPatterns,t.container,t.offset,s),t=(e=u.getOr({matches:[],position:t})).position,r=d,o=g,n=t.container,t=t.offset,a=s,void 0===(i=u.isNone())&&(i=!1),(0!==o.start.length||i?E(n,t,a).bind(function(n){return mt(r,o,a,n).bind(function(t){if(i){if(t.endContainer===n.container&&t.endOffset===n.offset)return v.none();if(0===n.offset&&t.endContainer.textContent.length===t.endOffset)return v.none()}return v.some(t)})}):((u=r.createRng()).setStart(n,t),u.setEnd(n,t),v.some(u))).map(function(t){var n=x(m,t.startContainer,t.startOffset,t.endContainer,t.endOffset);return{matches:e.matches.concat([{pattern:g,startRng:n,endRng:c}]),position:y(t.startContainer,t.startOffset)}}))})}(u,l,{pattern:o,remainingPatterns:i,position:t}));if(a.isSome())return a}}return v.none()})};j.add("textpattern",function(t){r=t.getParam("textpattern_patterns",vt,"array"),r=c(r)?(p((r=H(g(r,X))).errors,function(t){Y(t.message,t.pattern)}),Q(r.values)):(Y("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]}),n=r;var n,e,r={get:function(){return n},set:function(t){n=t}};return dt(t,r),e=r,{setPatterns:function(t){var n,t=H(g(t,X));if(0<t.errors.length)throw n=t.errors[0],new Error(n.message+":\n"+JSON.stringify(n.pattern,null,2));e.set(Q(t.values))},getPatterns:function(){return o(o([],g(e.get().inlinePatterns,z),!0),g(e.get().blockPatterns,z),!0)}}})}();