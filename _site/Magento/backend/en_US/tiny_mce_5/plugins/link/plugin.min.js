!function(){"use strict";function t(n){return function(t){return e=typeof(t=t),(null===t?"null":"object"==e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e)===n;var e}}function e(e){return function(t){return typeof t===e}}function s(){}function i(t){return function(){return t}}function n(t){return t}function U(t,e){return t===e}function r(){return c}function B(t){return o===t}var o,I=tinymce.util.Tools.resolve("tinymce.PluginManager"),K=tinymce.util.Tools.resolve("tinymce.util.VK"),u=t("string"),f=t("array"),z=e("boolean"),j=e("function"),a=i(!1),l=i(!(o=null)),c={fold:function(t,e){return t()},isSome:a,isNone:l,getOr:n,getOrThunk:m,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:n,orThunk:m,map:r,each:s,bind:r,exists:a,forall:l,filter:function(){return c},toArray:function(){return[]},toString:i("none()")};function m(t){return t()}function g(t){for(var e=[],n=0,r=t.length;n<r;++n){if(!f(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);mt.apply(e,t[n])}return e}function d(t,e){for(var n=0;n<t.length;n++){var r=e(t[n],n);if(r.isSome())return r}return S.none()}function h(t,e,n){return void 0===n&&(n=U),t.exists(function(t){return n(t,e)})}function p(t,e){return t?S.some(e):S.none()}function v(t){t=t.getParam("link_assume_external_targets",!1);return z(t)&&t?1:!u(t)||"http"!==t&&"https"!==t?0:t}function V(t){return t.getParam("default_link_target")}function q(t){return t.getParam("target_list",!0)}function F(t){return t.getParam("rel_list",[],"array")}function W(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")}function y(t){return u(t.value)?t.value:""}function H(e){return void 0===e&&(e=y),function(t){return S.from(t).map(function(t){return gt(t,e)})}}function k(t,e){return ht.call(t,e)}function G(t){return t&&"a"===t.nodeName.toLowerCase()}function J(t){return G(t)&&!!L(t)}function X(t,e){if(t.collapsed)return[];for(var t=t.cloneContents(),n=new pt(t.firstChild,t),r=[],o=t.firstChild;e(o)&&r.push(o),o=n.next(););return r}function $(t){return/^\w+:/i.test(t)}function Q(t,e){function n(t){return t.filter(function(t){return-1===_.inArray(r,t)})}var r=["noopener"],t=t?t.split(/\s+/):[],e=e?0<(e=n(e=t)).length?e.concat(r):r:n(t);return 0<e.length?_.trim(e.sort().join(" ")):""}function x(t,e){return e=e||t.selection.getNode(),E(e)?t.dom.select("a[href]",e)[0]:t.dom.getParent(e,"a[href]")}function Y(t,e){return(e?e.innerText||e.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")}function Z(t){return 0<_.grep(t,J).length}function tt(t){var e=t.schema.getTextInlineElements();return 0===X(t.selection.getRng(),function(t){return 1===t.nodeType&&!G(t)&&!k(e,t.nodeName.toLowerCase())}).length}function et(u,a,l){var t,e,n,r,c=u.selection.getNode(),s=x(u,c),f=(n=u,r=function(t,e,n){for(var r,o=t,i=0,u=o.length;i<u;i++)r=o[i],n=e(n,r,i);return n}(["title","rel","class","target"],function(e,n){return t[n].each(function(t){e[n]=0<t.length?t:null}),e},{href:(t=l).href}),r=D({},r),0<F(n).length||!1!==W(n)||(e=Q(r.rel,"_blank"===r.target),r.rel=e||null),S.from(r.target).isNone()&&!1===q(n)&&(r.target=V(n)),r.href=(e=r.href,"http"!==(n=v(n))&&"https"!==n||$(e)?e:n+"://"+e),r);u.undoManager.transact(function(){var e,n,t,r,o,i;l.href===a.href&&a.attach(),s?(u.focus(),t=u,r=s,o=l.text,i=f,o.each(function(t){k(r,"innerText")?r.innerText=t:r.textContent=t}),t.dom.setAttribs(r,i),t.selection.select(r)):(e=u,o=l.text,n=f,E(i=c)?yt(e,i,n):o.fold(function(){e.execCommand("mceInsertLink",!1,n)},function(t){e.insertContent(e.dom.createHTML("a",n,e.dom.encode(t)))}))})}function nt(t,e,n){o=t,i=n.href;var r,o,i,u,a,l,c,n=D(D({},n),{href:vt.isDomSafe(i,"a",o.settings)?i:""});t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,(o=n.class,i=n.href,u=n.rel,a=n.target,l=n.text,c=n.title,function(t,e,n,r){for(var o,i=t,u=dt(i),a=0,l=u.length;a<l;a++){var c=u[a];o=i[c],(e(o,c=c)?n:r)(o,c)}}({class:o.getOrNull(),href:i,rel:u.getOrNull(),target:a.getOrNull(),text:l.getOrNull(),title:c.getOrNull()},function(t,e){return!1===B(t)},(r=o={},function(t,e){r[e]=t}),s),o)):et(t,e,n)}function b(t){var u;t.hasPlugin("rtc",!0)?t.execCommand("unlink"):(u=t).undoManager.transact(function(){var t,e,n,r,o,i=u.selection.getNode();E(i)?ct(u,i):(o=(i=u).dom,e=(t=i.selection).getBookmark(),n=t.getRng().cloneRange(),r=o.getParent(n.startContainer,"a[href]",i.getBody()),o=o.getParent(n.endContainer,"a[href]",i.getBody()),r&&n.setStartBefore(r),o&&n.setEndAfter(o),t.setRng(n),i.execCommand("unlink"),t.moveToBookmark(e)),u.focus()})}function rt(t){var e=t.href;return 0<e.indexOf("@")&&-1===e.indexOf("/")&&-1===e.indexOf("mailto:")?S.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return D(D({},t),{href:"mailto:"+e})}}):S.none()}function O(t,e,n){t=t.getAttrib(e,n);return null!==t&&0<t.length?S.some(t):S.none()}function ot(t,e){return t.dom.getParent(e,"a[href]")}function it(t){return ot(t,t.selection.getStart())}function w(t,e){var n;e&&(n=L(e),/^#/.test(n)?(n=t.$(n)).length&&t.selection.scrollIntoView(n[0],!0):(t=e.href,(n=document.createElement("a")).target="_blank",n.href=t,n.rel="noreferrer noopener",(t=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n=n,t=t,document.body.appendChild(n),n.dispatchEvent(t),document.body.removeChild(n)))}function C(n){return function(){var c,t,e;e=x(t=c=n),Ct(t,e).then(function(t){var i,u,e=i=c,n=(t=u=t).anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),r=t.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],e=S.from(V(e)),o=t.anchor,a={url:{value:a=o.url.getOr(""),meta:{original:{value:a}}},text:o.text.getOr(""),title:o.title.getOr(""),anchor:a,link:a,rel:o.rel.getOr(""),target:o.target.or(e).getOr(""),linkClass:o.linkClass.getOr("")},e=t.catalogs,l=kt(a,e);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:g([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],n,r,function(t){for(var e=[],n=function(t){e.push(t)},r=0;r<t.length;r++)t[r].each(n);return e}([e.anchor.map(R.createUi("anchor","Anchors")),e.rels.map(R.createUi("rel","Rel")),e.targets.map(R.createUi("target","Open link in...")),e.link.map(R.createUi("link","Link list")),e.classes.map(R.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:a,onChange:function(e,t){t=t.name;l.onChange(e.getData,{name:t}).each(function(t){e.setData(t)})},onSubmit:function(t){var e,n,r=t.getData();function o(e){return S.from(r[e]).filter(function(t){return!h(u.anchor[e],t)})}r.url.value?(e={href:r.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},n={href:r.url.value,attach:void 0!==r.url.meta&&r.url.meta.attach?r.url.meta.attach:s},bt(i,e).then(function(t){nt(i,n,t)})):b(i),t.close()}}}).then(function(t){c.windowManager.open(t)})}}function N(t){return function(){w(t,it(t))}}function A(t,e){return t.on("NodeChange",e),function(){return t.off("NodeChange",e)}}function T(n){return function(t){function e(){return t.setActive(!n.mode.isReadOnly()&&null!==x(n,n.selection.getNode()))}return e(),A(n,e)}}function ut(n){return function(t){function e(){return t.setDisabled(null===x(n,n.selection.getNode()))}return e(),A(n,e)}}function at(r){return function(e){function n(t){return Z(t)||0<X(r.selection.getRng(),J).length}var t=r.dom.getParents(r.selection.getStart());return e.setDisabled(!n(t)),A(r,function(t){return e.setDisabled(!n(t.parents))})}}function lt(t){t=g(function(t){for(var e,n=t.length,r=new Array(n),o=0;o<n;o++){var i=t[o];r[o]=(e=void 0,(e=(i=i).name||i.id)?[{text:e,value:"#"+e}]:[])}return r}(t.dom.select("a:not([href])")));return 0<t.length?S.some([{text:"None",value:""}].concat(t)):S.none()}function P(n){function t(){return o}function e(t){return t(n)}var r=i(n),o={fold:function(t,e){return e(n)},isSome:l,isNone:a,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return P(t(n))},each:function(t){t(n)},bind:e,exists:e,forall:e,filter:function(t){return t(n)?o:c},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o}function ct(t,e){var n=t.dom.select("img",e)[0];n&&(e=t.dom.getParents(n,"a[href]",e)[0])&&(e.parentNode.insertBefore(n,e),t.dom.remove(e))}function st(n,t){return d(t,function(t){return k(e=t,"items")&&void 0!==e.items&&null!==e.items?st(n,t.items):p(t.value===n,t);var e})}var S={some:P,none:r,from:function(t){return null==t?c:P(t)}},ft=Array.prototype.indexOf,mt=Array.prototype.push,_=tinymce.util.Tools.resolve("tinymce.util.Tools"),gt=function(t,r){var o=[];return _.each(t,function(t){var e,n=u((n=t).text)?n.text:u(n.title)?n.title:"";void 0!==t.menu?(e=gt(t.menu,r),o.push({text:n,items:e})):(e=r(t),o.push({text:n,value:e}))}),o},R={sanitize:function(t){return H(y)(t)},sanitizeWith:H,createUi:function(e,n){return function(t){return{name:e,type:"listbox",label:n,items:t}}},getValue:y},D=function(){return(D=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},dt=Object.keys,ht=Object.hasOwnProperty,pt=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),vt=tinymce.util.Tools.resolve("tinymce.util.URI"),L=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},E=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},yt=function(t,e,n){e=t.dom.select("img",e)[0];e&&(t=t.dom.create("a",n),e.parentNode.insertBefore(t,e),t.appendChild(e))},kt=function(t,a){var l={text:t.text,title:t.title};return{onChange:function(t,e){var n,r,o,i,u=e.name;return"url"===u?(n=(r=t()).url,n=p(l.text.length<=0,S.from(n.meta.text).getOr(n.value)),r=r.url,r=p(l.title.length<=0,S.from(r.meta.title).getOr("")),n.isSome()||r.isSome()?S.some(D(D({},n.map(function(t){return{text:t}}).getOr({})),r.map(function(t){return{title:t}}).getOr({}))):S.none()):-1<ft.call(["anchor","link"],u)?(n=t(),e=("link"===(e=(r=e).name)?a.link:"anchor"===e?a.anchor:S.none()).getOr([]),o=l.text,n=n[r.name],i=0<o.length,void 0!==n?st(n,e).map(function(t){return{url:{value:t.value,meta:{text:i?o:t.text,attach:s}},text:i?o:t.text}}):S.none()):("text"!==u&&"title"!==u||(l[u]=t()[u]),S.none())}}},xt=tinymce.util.Tools.resolve("tinymce.util.Delay"),M=tinymce.util.Tools.resolve("tinymce.util.Promise"),bt=function(i,u){return d([rt,(n=v(i),r=i.getParam("link_default_protocol","http","string"),function(t){var e=t.href;return 1===n&&!$(e)||0===n&&/^\s*www(\.|\d\.)/i.test(e)?S.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return D(D({},t),{href:r+"://"+e})}}):S.none()})],function(t){return t(u)}).fold(function(){return M.resolve(u)},function(o){return new M(function(e){var n=i,t=o.message,r=n.selection.getRng();xt.setEditorTimeout(n,function(){n.windowManager.confirm(t,function(t){n.selection.setRng(r),e(t?o.preprocess(u):u)})})})});var n,r},Ot=tinymce.util.Tools.resolve("tinymce.util.XHR"),wt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],Ct=function(c,s){return t=(n=c).getParam("link_list"),new M(function(e){u(t)?Ot.send({url:t,success:function(t){return e(function(t){try{return S.some(JSON.parse(t))}catch(t){return S.none()}}(t))},error:function(t){return e(S.none())}}):j(t)?t(function(t){return e(S.some(t))}):e(S.from(t))}).then(function(t){return t.bind(R.sanitizeWith(e)).map(function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t})}).then(function(t){o=s,i=(r=c).dom,r=tt(r)?S.some(Y(r.selection,o)):S.none(),l=o?S.some(i.getAttrib(o,"href")):S.none(),a=o?S.from(i.getAttrib(o,"target")):S.none(),n=O(i,o,"rel"),e=O(i,o,"class");var e,n,r,o,i,u,a,l={url:l,text:r,title:O(i,o,"title"),target:a,rel:n,linkClass:e};return{anchor:l,catalogs:{targets:(r=q(c),f(r)?R.sanitize(r).orThunk(function(){return S.some(wt)}):!1===r?S.none():S.some(wt)),rels:(i=l.target,0<(a=F(o=c)).length?(u=h(i,"_blank"),(!1===W(o)?R.sanitizeWith(function(t){return Q(R.getValue(t),u)}):R.sanitize)(a)):S.none()),classes:0<(n=c.getParam("link_class_list",[],"array")).length?R.sanitize(n):S.none(),anchor:lt(c),link:t},optNode:S.from(s),flags:{titleEnabled:c.getParam("link_title",!0,"boolean")}}});function e(t){return n.convertURL(t.value||t.url,"href")}var n,t};I.add("link",function(t){var e,n,r,o,i,u,a;function l(t){var e=a.selection.getNode();return t.setDisabled(!x(a,e)),s}(e=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:C(e),onSetup:T(e)}),e.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:N(e),onSetup:ut(e)}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return b(e)},onSetup:at(e)}),(n=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:N(n),onSetup:ut(n)}),n.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:C(n)}),n.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return b(n)},onSetup:at(n)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return Z(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),(a=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:T(a)},label:"Link",predicate:function(t){return!!x(a,t)&&a.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=x(a);return t?L(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var e=a.selection.getNode();return t.setActive(!!x(a,e)),T(a)(t)},onAction:function(t){var e,n,r=t.getValue(),o=(e=r,o=x(a),n=tt(a),o||!n?S.none():(n=Y(a.selection,o),S.some(0<n.length?n:e)));nt(a,{href:r,attach:s},{href:r,text:o,title:S.none(),rel:S.none(),target:S.none(),class:S.none()}),a.selection.collapse(!1),t.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:l,onAction:function(t){b(a),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:l,onAction:function(t){N(a)(),t.hide()}}]}),(u=t).on("click",function(t){var e=ot(u,t.target);e&&K.metaKeyPressed(t)&&(t.preventDefault(),w(u,e))}),u.on("keydown",function(t){var e=it(u);e&&13===t.keyCode&&!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey&&(t.preventDefault(),w(u,e))}),(o=t).addCommand("mceLink",function(){o.getParam("link_quicklink",!1,"boolean")?o.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):C(o)()}),(i=t).addShortcut("Meta+K","",function(){i.execCommand("mceLink")})})}();