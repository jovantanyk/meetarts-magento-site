!function(){"use strict";function n(t){return function(n){return typeof n===t}}function i(n){return function(){return n}}function t(n){return n}function e(){return f}function o(n){return t=typeof(n=n),(null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t)===r;var t}var r,u=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=n("boolean"),a=n("number"),s=i(!(r="string")),l=i(!0),f={fold:function(n,t){return n()},isSome:s,isNone:l,getOr:t,getOrThunk:d,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:t,orThunk:d,map:e,each:function(){},bind:e,exists:s,forall:l,filter:function(){return f},toArray:function(){return[]},toString:i("none()")};function d(n){return n()}function m(n,t){for(var e=0,o=n.length;e<o;e++)t(n[e],e)}function g(n,t){for(var e=h(n),o=0,r=e.length;o<r;o++){var i=e[o];t(n[i],i)}}function v(e){function n(){return r}function t(n){return n(e)}var o=i(e),r={fold:function(n,t){return t(e)},isSome:l,isNone:s,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:n,orThunk:n,map:function(n){return v(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?r:f},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return r}var h=Object.keys;function p(n){return n.dom.nodeValue}function y(n,t,e){n=n.dom;if(!(o(e)||c(e)||a(e)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",e,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,e+"")}function b(n,t){n.dom.removeAttribute(t)}function w(n,t){t=null===(n=n.dom.getAttribute(t))?void 0:n;return void 0===t||""===t?[]:t.split(" ")}function T(n){return void 0!==n.dom.classList}function k(n,t){var e="";return g(n,function(n,t){e+=t}),new RegExp("["+e+"]",t?"g":"")}function N(n){return'<span data-mce-bogus="1" class="mce-'+P[n]+'">'+n+"</span>"}function M(n){var t=p(n);return _(n)&&void 0!==t&&F.test(t)}function A(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")}function O(i,n){m(j(B.fromDom(n),M),function(n){var t,e=n.dom.parentNode;if(A(e))e=B.fromDom(e),t=V,T(e)?e.dom.classList.add(t):(t=t,t=w(e=e,"class").concat([t]),y(e,"class",t.join(" ")));else{for(var o,e=i.dom.encode(p(n)).replace(I,N),r=i.dom.create("div",null,e);o=r.lastChild;)i.dom.insertAfter(o,n.dom);i.dom.remove(n.dom)}})}function C(r,n){m(r.dom.select(U,n),function(n){var t,e,o,i;A(n)?(t=B.fromDom(n),o=V,T(t)?t.dom.classList.remove(o):(i=o=o,0<(e=function(n){for(var t=[],e=0,o=n.length;e<o;e++){var r=n[e];r!==i&&t.push(r)}return t}(w(o=e=t,"class"))).length?y(o,"class",e.join(" ")):b(o,"class")),0===(T(e=t)?e.dom.classList:w(e,"class")).length&&b(e,"class")):r.dom.remove(n,!0)})}function S(n){var t=n.getBody(),e=n.selection.getBookmark(),o=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t);C(n,o=void 0!==o?o:t),O(n,o),n.selection.moveToBookmark(e)}function D(n,t){var e=n,o=t.get(),e=(e.fire("VisualChars",{state:o}),n.getBody());(!0===t.get()?O:C)(n,e)}function H(o,r){o.addCommand("mceVisualChars",function(){var n,t,e;n=o,(t=r).set(!t.get()),e=n.selection.getBookmark(),D(n,t),n.selection.moveToBookmark(e)})}function E(e,o){return function(t){function n(n){return t.setActive(n.state)}return t.setActive(o.get()),e.on("VisualChars",n),function(){return e.off("VisualChars",n)}}}function L(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:n}}"undefined"==typeof window&&Function("return this;")();function _(n){return 3===n.dom.nodeType}var x,B={fromHtml:function(n,t){t=(t||document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return L(t.childNodes[0])},fromTag:function(n,t){return L((t||document).createElement(n))},fromText:function(n,t){return L((t||document).createTextNode(n))},fromDom:L,fromPoint:function(n,t,e){return(null==(n=n.dom.elementFromPoint(t,e))?f:v(n)).map(L)}},P={" ":"nbsp","­":"shy"},F=k(P),I=k(P,!0),U=(x="",g(P,function(n){x&&(x+=","),x+="span.mce-"+n}),x),V="mce-nbsp",j=function(n,t){var e=[];return m(function(n,t){for(var e=n.length,o=new Array(e),r=0;r<e;r++){var i=n[r];o[r]=t(i,r)}return o}(n.dom.childNodes,B.fromDom),function(n){e=(e=t(n)?e.concat([n]):e).concat(j(n,t))}),e},K=tinymce.util.Tools.resolve("tinymce.util.Delay");u.add("visualchars",function(n){l=n.getParam("visualchars_default_state",!1),t=l;var t,e,o,r,i,u,c,a,s,l={get:function(){return t},set:function(n){t=n}};function f(){return e.execCommand("mceVisualChars")}return H(n,l),(e=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:f,onSetup:E(e,o=l)}),e.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:f,onSetup:E(e,o)}),r=n,i=l,u=K.debounce(function(){S(r)},300),!1!==r.getParam("forced_root_block")&&r.on("keydown",function(n){!0===i.get()&&(13===n.keyCode?S(r):u())}),r.on("remove",u.stop),a=l,(c=n).on("init",function(){D(c,a)}),s=l,{isEnabled:function(){return s.get()}}})}();