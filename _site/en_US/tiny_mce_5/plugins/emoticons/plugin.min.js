!function(){"use strict";function r(){}function i(t){return function(){return t}}function t(t){return t}function n(){return c}var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),l=i(!1),a=i(!null),c={fold:function(t,n){return t()},isSome:l,isNone:a,getOr:t,getOrThunk:o,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:t,orThunk:o,map:n,each:r,bind:n,exists:l,forall:a,filter:function(){return c},toArray:function(){return[]},toString:i("none()")};function o(t){return t()}function d(t){var n=t;return{get:function(){return n},set:function(t){n=t}}}function f(t,n){for(var e=w(t),o=0,r=e.length;o<r;o++){var i=e[o];n(t[i],i)}}function m(t,n){return O.call(t,n)}function g(){t=r,n=d(p.none());var t,n,e={clear:function(){o(),n.set(p.none())},isSet:function(){return n.get().isSome()},get:function(){return n.get()},set:function(t){o(),n.set(p.some(t))}};function o(){n.get().each(t)}return b(b({},e),{on:function(t){return e.get().each(t)}})}function s(t,n){return-1!==t.indexOf(n)}function u(c,r,t){var u=g(),l=g(),s=c.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string");function e(){return l.get().getOr([])}function i(){return u.isSet()&&l.isSet()}return c.on("init",function(){C.load(t,r).then(function(t){var n=c.getParam("emoticons_append",{},"object"),e=function(t){return b({keywords:[],category:"user"},t)};o=function(t,n){return{k:n,v:e(t)}},r={},f(n,function(t,n){t=o(t,n);r[t.k]=t.v});var o,r,n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var e={},o=0;o<t.length;o++){var r,i=t[o];for(r in i)m(i,r)&&(e[r]=i[r])}return e}(t,r),i={},a=[];f(n,function(t,n){var t={title:n,keywords:t.keywords,char:(e=(n=t).char).length>="<img".length&&"<img"===e.substr(0,0+"<img".length)?n.char.replace(/src="([^"]+)"/,function(t,n){return'src="'+s+n+'"'}):n.char,category:m(e=_,n=t.category)?e[n]:n},e=void 0!==i[t.category]?i[t.category]:[];i[t.category]=e.concat([t]),a.push(t)}),u.set(i),l.set(a)},function(t){console.log("Failed to load emoticons: "+t),u.set({}),l.set([])})}),{listCategories:function(){return[A].concat(w(u.get().getOr({})))},hasLoaded:i,waitForLoad:function(){return i()?j.resolve(!0):new j(function(t,n){var e=15,o=k.setInterval(function(){i()?(k.clearInterval(o),t(!0)):--e<0&&(console.log("Could not load emojis from url: "+r),k.clearInterval(o),n(!1))},100)})},listAll:e,listCategory:function(n){return n===A?e():u.get().bind(function(t){return p.from(t[n])}).getOr([])}}}function h(t,n,e){for(var o,r,i=[],a=n.toLowerCase(),c=e.fold(function(){return l},function(n){return function(t){return n<=t}}),u=0;u<t.length&&(0!==n.length&&(o=t[u],r=a,!s(o.title.toLowerCase(),r))&&!function(t){for(var n=0,e=t.length;n<e;n++)if(s(t[n].toLowerCase(),r))return 1}(o.keywords)||(i.push({value:t[u].char,text:t[u].title,icon:t[u].char}),!c(i.length)));u++);return i}function y(t){t.on("PreInit",function(){t.parser.addAttributeFilter("data-emoticon",function(t){for(var n,e=t,o=0,r=e.length;o<r;o++)(n=e[o]).attr("data-mce-resize","false"),n.attr("data-mce-placeholder","1")})})}function v(e){function t(){return r}function n(t){return t(e)}var o=i(e),r={fold:function(t,n){return n(e)},isSome:a,isNone:l,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:t,orThunk:t,map:function(t){return v(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?r:c},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return r}var p={some:v,none:n,from:function(t){return null==t?c:v(t)}},b=function(){return(b=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},w=Object.keys,O=Object.hasOwnProperty,C=tinymce.util.Tools.resolve("tinymce.Resource"),k=tinymce.util.Tools.resolve("tinymce.util.Delay"),j=tinymce.util.Tools.resolve("tinymce.util.Promise"),A="All",_={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},T="pattern";e.add("emoticons",function(t,n){n=n,i=(a=t).getParam("emoticons_database","emojis","string");var m,g,e,o,r,n=a.getParam("emoticons_database_url",n+"/js/"+i+a.suffix+".js","string"),i=t.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"),a=u(t,n,i);function c(){return e.execCommand("mceEmoticons")}g=a,(m=t).addCommand("mceEmoticons",function(){return o=m,n={pattern:"",results:h((r=g).listAll(),"",p.some(300))},c=d(A),i=function(t){var n=(t=t).getData(),e=c.get(),n=h(r.listCategory(e),n[T],e===A?p.some(300):p.none());t.setData({results:n})},a=null,u={cancel:e,throttle:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e(),a=setTimeout(function(){a=null,i.apply(null,t)},200)}},l={label:"Search",type:"input",name:T},s={type:"collection",name:"results"},(f=o.windowManager.open(t())).focus(T),void(r.hasLoaded()||(f.block("Loading emoticons..."),r.waitForLoad().then(function(){f.redial(t()),u.throttle(f),f.focus(T),f.unblock()}).catch(function(t){f.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),f.focus(T),f.unblock()})));function e(){null!==a&&(clearTimeout(a),a=null)}function t(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(t){for(var n=t.length,e=new Array(n),o=0;o<n;o++){var r=t[o];e[o]={title:r,name:r,items:[l,s]}}return e}(r.listCategories())},initialData:n,onTabChange:function(t,n){c.set(n.newTabName),u.throttle(t)},onChange:u.throttle,onAction:function(t,n){"results"===n.name&&(n=n.value,o.insertContent(n),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var o,r,i,a,n,c,u,l,s,f}),(e=t).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:c}),e.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:c}),r=a,(o=t).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(t,n){return r.waitForLoad().then(function(){return h(r.listAll(),t,p.some(n))})},onAction:function(t,n,e){o.selection.setRng(n),o.insertContent(e),t.hide()}}),y(t)})}();